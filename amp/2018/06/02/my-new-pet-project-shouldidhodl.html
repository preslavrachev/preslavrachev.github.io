<!doctype html>
<html amp lang="en">
  <head>
    <meta charset="utf-8">
    <title>Introducing My New Pet Project: Should I HODL</title>
    <link rel="canonical" href="https://preslav.me/2018/06/02/my-new-pet-project-shouldidhodl/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,600,400" />
    <style amp-custom>
      html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{margin:0.67em 0;font-size:2em}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{position:relative;vertical-align:baseline;font-size:75%;line-height:0}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}amp-img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{cursor:pointer;-webkit-appearance:button}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{margin:0 2px;padding:0.35em 0.625em 0.75em;border:1px solid #c0c0c0}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}html{max-height:100%;height:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0)}body{max-height:100%;height:100%;color:#3a4145;background:#f4f8fb;letter-spacing:0.01rem;font-family:"Merriweather", serif;font-size:1.8rem;line-height:1.75em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{margin:0 0 0.3em 0;color:#2e2e2e;font-family:"Open Sans", sans-serif;line-height:1.15em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-moz-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-o-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1}h1{text-indent:-2px;letter-spacing:-1px;font-size:2.6rem}h2{letter-spacing:0;font-size:2.4rem}h3{letter-spacing:-0.6px;font-size:2.1rem}h4{font-size:1.9rem}h5{font-size:1.8rem}h6{font-size:1.8rem}a{color:#4a4a4a}a:hover{color:#111}p,ul,ol,dl{margin:0 0 2.5rem 0;font-size:1.5rem;text-rendering:geometricPrecision;-webkit-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-moz-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-o-font-feature-settings:"liga" 1, "onum" 1, "kern" 1}ol,ul{padding-left:2em}ol ol,ul ul,ul ol,ol ul{margin:0 0 0.4em 0;padding-left:2em}dl dt{float:left;clear:left;overflow:hidden;margin-bottom:1em;width:180px;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd{margin-bottom:1em;margin-left:200px}li{margin:0.4em 0}li li{margin:0}hr{display:block;margin:1.75em 0;padding:0;height:1px;border:0;border-top:#efefef 1px solid}blockquote{box-sizing:border-box;margin:1.75em 0 1.75em 0;padding:0 0 0 1.75em;border-left:#4a4a4a 0.4em solid;-moz-box-sizing:border-box}blockquote p{margin:0.8em 0;font-style:italic}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;color:#ccc;font-size:0.9em}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:normal}mark{background-color:#fdffb6}code,tt{padding:1px 3px;border:#e3edf3 1px solid;background:#f7fafb;border-radius:2px;white-space:pre-wrap;font-family:Inconsolata, monospace, sans-serif;font-size:0.85em;font-feature-settings:"liga" 0;-webkit-font-feature-settings:"liga" 0;-moz-font-feature-settings:"liga" 0}pre{overflow:auto;box-sizing:border-box;margin:0 0 1.75em 0;padding:10px;width:100%;border:#e3edf3 1px solid;background:#f7fafb;border-radius:3px;white-space:pre;font-family:Inconsolata, monospace, sans-serif;font-size:0.9em;-moz-box-sizing:border-box}pre code,pre tt{padding:0;border:none;background:transparent;white-space:pre-wrap;font-size:inherit}kbd{display:inline-block;margin-bottom:0.4em;padding:1px 8px;border:#ccc 1px solid;background:#f4f4f4;border-radius:4px;box-shadow:0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 0 #fff inset;color:#666;text-shadow:#fff 0 1px 0;font-size:0.9em;font-weight:700}table{box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%;background-color:transparent;-moz-box-sizing:border-box}table th,table td{padding:8px;border-top:#efefef 1px solid;vertical-align:top;text-align:left;line-height:20px}table th{color:#000}table caption + thead tr:first-child th,table caption + thead tr:first-child td,table colgroup + thead tr:first-child th,table colgroup + thead tr:first-child td,table thead:first-child tr:first-child th,table thead:first-child tr:first-child td{border-top:0}table tbody + tbody{border-top:#efefef 2px solid}table table table{background-color:#fff}table tbody > tr:nth-child(odd) > td,table tbody > tr:nth-child(odd) > th{background-color:#f6f6f6}table.plain tbody > tr:nth-child(odd) > td,table.plain tbody > tr:nth-child(odd) > th{background:transparent}iframe,amp-iframe,.fluid-width-video-wrapper{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper amp-iframe{margin:0}textarea,select,input{margin:0 0 5px 0;padding:6px 9px;width:260px;outline:0;border:#e7eef2 1px solid;background:#fff;border-radius:4px;box-shadow:none;font-family:"Open Sans", sans-serif;font-size:1.6rem;line-height:1.4em;font-weight:100;-webkit-appearance:none}textarea{min-width:250px;min-height:80px;max-width:340px;width:100%;height:auto}input[type="text"]:focus,input[type="email"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="number"]:focus,input[type="date"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="time"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,textarea:focus{outline:none;outline-width:0;border:#bbc7cc 1px solid;background:#fff}select{width:270px;height:30px;line-height:30px}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.main-header{position:relative;display:table;overflow:hidden;box-sizing:border-box;width:100%;height:50px;background:#5ba4e5 no-repeat center center;background-size:cover;text-align:left;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.content{background:#fff;padding-top:15px}.blog-title,.content{margin:auto;max-width:600px}.blog-title a{display:block;padding-right:16px;padding-left:16px;height:50px;color:#fff;text-decoration:none;font-family:"Open Sans", sans-serif;font-size:16px;line-height:50px;font-weight:600}.post{position:relative;margin-top:0;margin-right:16px;margin-left:16px;padding-bottom:0;max-width:100%;border-bottom:#ebf2f6 1px solid;word-wrap:break-word;font-size:0.95em;line-height:1.65em}.post-header{margin-bottom:1rem}.post-title{margin-bottom:0}.post-title a{text-decoration:none}.post-meta{display:block;margin:3px 0 0 0;color:#9eabb3;font-family:"Open Sans", sans-serif;font-size:1.3rem;line-height:2.2rem}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.post-meta .author{margin:0;font-size:1.3rem;line-height:1.3em}.post-date{display:inline-block;text-transform:uppercase;white-space:nowrap;font-size:1.2rem;line-height:1.2em}.post-image{margin:0;padding-top:3rem;padding-bottom:30px;border-top:1px #E8E8E8 solid}.post-content amp-img,.post-content amp-anim{position:relative;left:50%;display:block;padding:0;min-width:0;max-width:112%;width:calc(100% + 32px);height:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%)}.footnotes{font-size:1.3rem;line-height:1.6em;font-style:italic}.footnotes li{margin:0.6rem 0}.footnotes p{margin:0}.footnotes p a:last-child{text-decoration:none}.site-footer{position:relative;margin:0 auto 20px auto;padding:1rem 15px;max-width:600px;color:rgba(0,0,0,0.5);font-family:"Open Sans", sans-serif;font-size:1.1rem;line-height:1.75em}.site-footer a{color:rgba(0,0,0,0.5);text-decoration:none;font-weight:bold}.site-footer a:hover{border-bottom:#bbc7cc 1px solid}.poweredby{display:block;float:right;width:45%;text-align:right}.copyright{display:block;float:left;width:45%}
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>

<header class="main-header">
  <nav class="blog-title">
    <a href="https://preslav.me">
      Preslav Rachev
    </a>
  </nav>
</header>

<main class="content" role="main">
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">Introducing My New Pet Project: Should I HODL</h1>
      <section class="post-meta">
        <p class="author">by <a href="#"></a></p>
        <time class="post-date" datetime="2018-02-16">June 2, 2018</time>
      </section>
    </header>
    <section class="post-content">
      <div class="kg-card-markdown">
        <p>My crypto-obsession from last year might have died down a little, but I still remain a long-term investor and a believer of decentralization. Moreover, it was predicting the crypto market’s next move that made dust off some of my old machine learning experiments and gave a fresh boost to my mission of becoming a data scientist. Though one could hardly hear me speak about this coin or that, I am still actively researching and building tools.</p>

<p>Tools like <a href="https://preslav.me/shouldihodl/">ShouldIHODL</a>. It is an extremely simple website that does nothing else, but spit out a Yes or No to the question, of whether it is a good day to invest in Bitcoin or not. Emphasis on the word <strong>invest</strong> =&gt; buy for the longer term. I am not interested in sheer speculation, or the manipulated pump-and-dump schemes that flooded the markets last year. Also, it should go without saying that this is a simple side project built mainly for fun and learning purposes, and no financial advice of any kind. I don’t want to bear any responsibility for potential losses or missed opportunities on anyone’s behalf.</p>

<p><amp-img src="/assets/img/2018/june/shouldihodl_screen.jpg" alt="ShouldIHODL" layout="responsive"><noscript><img src="/assets/img/2018/june/shouldihodl_screen.jpg" alt="ShouldIHODL"></noscript></amp-img></p>

<h2 id="how-does-it-work">How does it work?</h2>
<h3 id="the-raw-data">The raw data</h3>
<p>There is a fair bit of machine learning involved into the decision. First, a few tens of thousands of data points get fetched through the open <a href="https://poloniex.com/support/api/">Poloniex API</a>. Each data point represents a 30-min interval from Bitcoin’s price history, containing data known from common charting tools and APIs:</p>

<ul>
  <li>
<code class="highlighter-rouge">open</code> - price at the start of the interval</li>
  <li>
<code class="highlighter-rouge">close</code> - price at the end of the interval</li>
  <li>
<code class="highlighter-rouge">low</code> - lowest price reached throughout the interval</li>
  <li>
<code class="highlighter-rouge">high</code> - the highest price reached throughout the interval</li>
  <li>
<code class="highlighter-rouge">quoteVolume</code> - volume movement expressed in units of the quote currency, a.k.a BTC</li>
  <li>
<code class="highlighter-rouge">baseVolume</code> - volume movement expressed in units of the base currency, either USD, EUR, or as in our case <a href="https://tether.to/">USDT</a>
</li>
</ul>

<p>The first four are better known to chart enthusiasts and traders as what describes a <a href="https://www.investopedia.com/terms/c/candlestick.asp">candlestick</a>:</p>

<p><amp-img src="https://i.investopedia.com/inv/dictionary/terms/candle.gif" alt="Candlestick" width="250" height="185" layout="responsive"><noscript><img src="https://i.investopedia.com/inv/dictionary/terms/candle.gif" alt="Candlestick" width="250" height="185"></noscript></amp-img>
Photo: <a href="https://www.investopedia.com/terms/c/candlestick.asp">Investopedia</a></p>

<h3 id="cleaning-up-and-extracting-some-features">Cleaning up and extracting some features</h3>
<p>The next step is taming the raw data into a <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html">Pandas DataFrame</a>:</p>

<p><amp-img src="/assets/img/2018/june/raw_inputs.jpg" alt="Raw Data Inputs" layout="responsive"><noscript><img src="/assets/img/2018/june/raw_inputs.jpg" alt="Raw Data Inputs"></noscript></amp-img></p>

<p>Having a few thousand candlesticks, one can use Pandas’ amazing <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.rolling.html">rolling</a> capabilities, in order to roll down HiLo ratios and moving averages normalized to the maximum in a given period:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_periods_in_7d</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span> <span class="c"># Once, every 30 min</span>

<span class="n">df</span><span class="p">[</span><span class="s">'hilo_7d'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'low'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">num_periods_in_7d</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span>
<span class="n">df</span><span class="p">[</span><span class="s">'high].rolling(num_periods_in_7d).mean()</span><span class="err">
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Still volatile, but less so than the current price</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ma_30'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'avg_price'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c"># Reacting slowly to rapid changes. Can be used as a line of</span>
<span class="c"># support / resistance</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ma_6400'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'avg_price'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">6400</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c"># Gives an idea how far the average price is from a past peak,</span>
<span class="c"># or if it is at the peak itself</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ma_30_6400_ratio'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'ma_30'</span><span class="p">]</span> <span class="o">/</span> 
<span class="n">df</span><span class="p">[</span><span class="s">'avg_price'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">6400</span><span class="p">)</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span>
</code></pre></div></div>

<p>Gather a few of those, and you will effectively have established a simple way of representing <a href="https://www.investopedia.com/articles/technical/112601.asp">price patterns</a> across a certain time window:</p>

<p><amp-img src="/assets/img/2018/june/price_patterns.jpg" alt="Price Patterns" layout="responsive"><noscript><img src="/assets/img/2018/june/price_patterns.jpg" alt="Price Patterns"></noscript></amp-img></p>

<p>To save you further details, ratios like these are quite popular in technical analysis, and go under the name of “oscillators”. It has been proven that prices don’t just go wildly in one direction or another, but behave somewhat like forces in physics. An upward movement for instance, is caused by the force applied to the price by the buying group. It can’t go up indefinitely (even in crypto-land), but eventually faces a force of resistance which forces the price downward. That’s why after normalization, prices lines resemble sine waves and can be analyzed as such. For those of you interested in more technical analysis fundamentals, I would suggest getting familiar with the concepts of <a href="https://www.investopedia.com/university/technical/techanalysis4.asp">support and resistance</a>.</p>

<h3 id="categorizing-the-cases">Categorizing the cases</h3>
<p>Based only on the inputs, how will our machine learning algorithm know which of them indicate a potential upward or downward movement? That’s right, we need to categorize them first. One simple way to do so, is to compare the price at any given time <code class="highlighter-rouge">T</code> with a price some time in the future (say, a week) - <code class="highlighter-rouge">T'</code>. If the price a week down the road is greater than the price at time <code class="highlighter-rouge">T</code>, we label the case as 1 (uptrend), or alternatively, as -1 (downtrend). Using Pandas’ forwards-and-backwards shifting function, this is a piece of cake:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># negative shifting will pair </span>
<span class="n">df</span><span class="p">[</span><span class="s">'future_price'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'ma_6400'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">num_periods_in_7d</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s">'future_price_chg'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'future_price'</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s">'ma_6400'</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'future_price_chg'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'future_price_chg'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></div>

<h3 id="choosing-a-machine-learning-algorithm">Choosing a machine learning algorithm</h3>

<p>Having extracted the features and labeled the data, our input matrix starts looking like a bunch of gibberish, but to the trained eye, and hopefully, to our machine learning algorithm it will be more than enough.</p>

<p><amp-img src="/assets/img/2018/june/extracted_input_features.jpg" alt="Extracted Input Features" layout="responsive"><noscript><img src="/assets/img/2018/june/extracted_input_features.jpg" alt="Extracted Input Features"></noscript></amp-img></p>

<p>In the world of machine learning, there are many algorithms, each of which serving a different purpose. As much as media want you to believe in, ML is not all about neural nets. In fact, for the purposes of this project, I will use a <a href="http://scikit-learn.org/stable/modules/tree.html">decision tree classifier</a> instead. Designed well, decision trees can be just as effective, at a fraction of the size and complexity of a decent neural network.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">sklearn</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="err">’</span><span class="n">gini</span><span class="err">’</span><span class="p">,</span> 
                                          <span class="n">splitter</span><span class="o">=</span><span class="err">’</span><span class="n">best</span><span class="err">’</span><span class="p">,</span> 
                                          <span class="n">max_depth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                                          <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                                          <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                                          <span class="n">min_weight_fraction_leaf</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
                                          <span class="n">max_features</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                                          <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                                          <span class="n">max_leaf_nodes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                                          <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
                                          <span class="n">min_impurity_split</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                                          <span class="n">class_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                                          <span class="n">presort</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p>Unlike deep NNs, decision trees have the advantage that they can be visualized easily. A decision tree graph can be exported and presented to a human expert who could confirm, if the branching criteria selected by the algorithm seems logical.</p>

<p><amp-img src="/assets/img/2018/june/sample_decision_tree.jpg" alt="Sample Decision Tree" layout="responsive"><noscript><img src="/assets/img/2018/june/sample_decision_tree.jpg" alt="Sample Decision Tree"></noscript></amp-img></p>

<p>One disadvantage of decision trees is that they easily overfit, i.e. learn to solve the problem with the particular inputs at hand, but fail to really generalize the solution. All types of machine learning algorithm suffer from this, and there is really no single answer as to how to cope with it. One way is having your input data shuffled and split into two subsets. One goes for training the classifier, the other one for testing the accuracy of the algorithm:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>

<span class="n">inputs_train</span><span class="p">,</span> <span class="n">inputs_test</span><span class="p">,</span> <span class="n">labels_train</span><span class="p">,</span> <span class="n">labels_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

<span class="n">tree_classifier</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>
<span class="n">tree_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">inputs_train</span><span class="p">,</span> <span class="n">labels_train</span><span class="p">)</span>

<span class="c"># The testing data has not been fed to the estimator before</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">tree_classifier</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">inputs_test</span><span class="p">,</span> <span class="n">labels_test</span><span class="p">)</span>
</code></pre></div></div>

<p>While training, you can also introduce epoch-wise fitting using something like input data folding. Folding is a fancy name for splitting the original data set into a number of subsets, and deriving training and testing data points from each one:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>

<span class="n">tree_classifier</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>

<span class="k">for</span> <span class="n">train_index</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">labels</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
	<span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">],</span> <span class="n">labels</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
	
	<span class="n">tree_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">inputs_train</span><span class="p">,</span> <span class="n">labels_train</span><span class="p">)</span>
	
	<span class="c"># This score relates to the particular subset only</span>
	<span class="c"># You can yield it and average out the scores for all subsets</span>
	<span class="c"># at then end. You can also fit each subset into a new tree.</span>
	<span class="c"># When predicting the overall score, all trees need to be called,</span>
	<span class="c"># and the results of their scores averaged out. </span>
	<span class="n">score</span> <span class="o">=</span> <span class="n">tree_classifier</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">inputs_test</span><span class="p">,</span> <span class="n">labels_test</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="note-on-random-forests">Note on Random Forests</h4>
<p>Another, perhaps even better option is to use random forests. A random forest is a collection of trees, generated using randomized hyperparameters (max depth, min split count, max number of leaf nodes, etc), to each of which different inputs are fed. When predictions are derived, each tree is asked to predict a result separately, and the majority vote is taken:</p>

<p><amp-img src="https://upload.wikimedia.org/wikipedia/commons/c/c7/Randomforests_ensemble.gif" alt="Random Forest Ensemble / Wikimedia" width="640" height="360" layout="responsive"><noscript><img src="https://upload.wikimedia.org/wikipedia/commons/c/c7/Randomforests_ensemble.gif" alt="Random Forest Ensemble / Wikimedia" width="640" height="360"></noscript></amp-img> 
Source: <a href="https://commons.wikimedia.org/wiki/File:Randomforests_ensemble.gif">Wikimedia</a></p>

<p>A random forest is trained and tested in pretty much the same way as a single decision tree:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>

<span class="c"># An important parameter here is the number of trees in the forest</span>
<span class="n">tree_classifier</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c"># Cross-val-score combines folding, splitting, and scoring in one function</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">tree_classifier</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></div>

<p>No matter how you approach it, once trained, the classifier can be used for predicting the outcome of a future event, by feeding it with current pricing data (transformed into input features, of course):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">current_point_as_inputs</span> <span class="o">=</span> <span class="n">extract_inputs_from_data_frame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

<span class="c"># This call will return either `1` or `-1` (our labels)</span>
<span class="n">end_class</span> <span class="o">=</span> <span class="n">tree_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">current_point_as_inputs</span><span class="p">)</span>

<span class="c"># This call will return an array of probabilities for each class to occur</span>
<span class="n">class_probs</span> <span class="o">=</span> <span class="n">tree_classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">current_point_as_inputs</span><span class="p">)</span>
<span class="c"># class_probs =&gt; [0.23, 0,77]</span>
</code></pre></div></div>

<h3 id="rendering-the-outputs-and-scheduling-daily-updates">Rendering the outputs and scheduling daily updates</h3>
<p>Having made our classifier output a decision, it is time to display it to visitors of the website. Since this entire operation is being read from and hosted on GitHub, I am using the magic of <a href="https://travis-ci.org/">Travis</a> to fetch and transform historical data, feed it through a decision tree classifier, and render the output using a static site generator for Python, called <a href="https://blog.getpelican.com/">Pelican</a>. Travis supports scheduled corn rebuilds of a certain branch which are ideal for my purpose. So, in essence, I’m doing all of this using pretty much using only a crown job, and some GitHub disk space for storing the rendered outputs. Let’s talk about serverless architecture, shall we? 😀</p>

<h2 id="what-is-in-it-for-me">What is in it for me?</h2>
<p>Nothing. I am neither planning to profit from the website, nor to collect user data or track user behavior. At the moment, I am doing this only for learning, and personal development purposes. Everyone is allowed to check out the site, as well as the code, leave comments, posts suggestions and pull requests. As mentioned at the beginning of the article, this tool is not a professional trading advice, and basing your trading decisions solely on what it shows you, will be equal to spending your money on the national lottery (which many of you do, but still).</p>

<p>Enjoy, and don’t hesitate to leave me feedback, or share the word on <a href="https://twitter.com/intent/tweet?text=Should%20I%20HODL%20is%20a%20neat%20machine%20learning%20toy%20project%20by%20%40preslavrachev&amp;url=https%3A%2F%2Fpreslav.me%2Fshouldihodl">Twitter</a> with your friends.</p>

      </div>
    </section>
  </article>
</main>
<footer class="site-footer clearfix">
  <section class="copyright"><a href="http://www.preslav.me">Preslav's Thoughts and Ramblings</a> © 2019</section>
  <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a></section>
</footer>
</body>
</html>
